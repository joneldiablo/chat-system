{"version":3,"sources":["../../../src/api/controllers/message-controller.js"],"names":["MessageController","MessageModel","data","senderId","auth","id","receiverId","messages","query","where","orWhere","limit","orderBy","reverse","parseInt","r","body","Controller"],"mappings":"44CAGqBA,kB,aAEnB;;KAGA,YAAc,kHACNC,oBADM,EAEb,CAED;;6EAGUC,C,CAAM,IACVC,GAAWD,EAAKE,IAAL,CAAUC,EADX,CAEVC,EAAaJ,EAAKI,UAFR,CAGVC,EAAW,KAAMN,sBAAaO,KAAb,GAClBC,KADkB,CACZ,CAAEN,UAAF,CAAYG,YAAZ,CADY,EAElBI,OAFkB,CAEV,CAAEP,SAAUG,CAAZ,CAAwBA,WAAYH,CAApC,CAFU,EAGlBQ,KAHkB,CAGZ,EAHY,EAIlBC,OAJkB,CAIV,MAJU,CAIF,MAJE,CAHP,CAQd,MAAOL,GAASM,OAAT,EACR,CAED;;;yCAIUX,C,CAAM,CACdA,EAAKI,UAAL,CAAkBQ,SAASZ,EAAKI,UAAd,CADJ,CAEdJ,EAAKC,QAAL,CAAgBW,SAASZ,EAAKC,QAAd,CAFF,CAGd,GAAIY,GAAI,2FAAgB,CAAEC,KAAMd,CAAR,CAAhB,CAAgC,EAAhC,CAAoC,EAApC,CAAwC,IAAxC,IAAR,CACA,MAAOa,EACR,C,OAhC4CE,4B,kBAA1BjB,iB","file":"message-controller.js","sourcesContent":["import Controller from \"abstract-controller\";\nimport { MessageModel } from \"../models\";\n\nexport default class MessageController extends Controller {\n\n  /**\n   * \n   */\n  constructor() {\n    super(MessageModel);\n  }\n\n  /**\n   * \n   */\n  async get(data) {\n    let senderId = data.auth.id;\n    let receiverId = data.receiverId;\n    let messages = await MessageModel.query()\n      .where({ senderId, receiverId })\n      .orWhere({ senderId: receiverId, receiverId: senderId })\n      .limit(50)\n      .orderBy('date', 'desc');\n    return messages.reverse();\n  }\n\n  /**\n   * \n   * @param {*} data \n   */\n  async set(data) {\n    data.receiverId = parseInt(data.receiverId);\n    data.senderId = parseInt(data.senderId);\n    let r = await super.set({ body: data }, {}, {}, null, true);\n    return r;\n  }\n\n}"]}