{"version":3,"sources":["../../../src/api/db/index.js"],"names":["DbKnex","knexConfig","_knex","knex","console","log","connection","database","on","i","sql","data","replace","bindings","dbKnex","client","queryLog"],"mappings":"slBAGMA,O,YAEJ,WAAYC,CAAZ,CAAwB,yBACtB,KAAKC,KAAL,CAAa,mBAAKD,CAAL,CACd,CAED;;yDAGM,IACSE,EADT,CACkB,IADlB,CACED,KADF,CAEJE,QAAQC,GAAR,MAAiBC,WAAWC,QAA5B,0BAFI,CAGJJ,EAAKK,EAAL,CAAQ,OAAR,CAAiB,WAAQ,CACvBJ,QAAQC,GAAR,CAAY,8BAAZ,CADuB,IAEnBI,GAAI,CAFe,CAGnBC,EAAMC,EAAKD,GAAL,CAASE,OAAT,CAAiB,KAAjB,CAAwB,UAAK,CACrC,MAAO,IAAMD,EAAKE,QAAL,CAAcJ,GAAd,CAAN,CAA2B,GACnC,CAFS,CAHa,CAMvBL,QAAQC,GAAR,CAAYK,CAAZ,CANuB,CAOvBN,QAAQC,GAAR,CAAY,oBAAZ,CACD,CARD,CASD,CAED;;mCAGW,CACT,MAAO,MAAKH,KACb,C,SAGCY,OAAS,GAAId,OAAJ,CAAW,CACtBe,OAAQ,OADc,CAEtBT,qBAFsB,CAAX,C,CAITU,gB,EACFF,OAAOT,GAAP,E,iBAGaS,OAAOX,I","file":"index.js","sourcesContent":["import Knex from 'knex';\nimport { db as connection, queryLog } from \"../../config\";\n\nclass DbKnex {\n\n  constructor(knexConfig) {\n    this._knex = Knex(knexConfig);\n  }\n\n  /**\n   * \n   */\n  log() {\n    let { _knex: knex } = this;\n    console.log(`- ${connection.database} db: Query log enabled`);\n    knex.on('query', data => {\n      console.log('======== on query ==========');\n      let i = 0;\n      let sql = data.sql.replace(/\\?/g, k => {\n        return '\"' + data.bindings[i++] + '\"';\n      });\n      console.log(sql);\n      console.log('==================');\n    });\n  }\n\n  /**\n   * \n   */\n  get knex() {\n    return this._knex\n  }\n}\n\nlet dbKnex = new DbKnex({\n  client: 'mysql',\n  connection\n});\nif (queryLog) {\n  dbKnex.log();\n}\n\nexport default dbKnex.knex;"]}